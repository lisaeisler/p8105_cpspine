---
title: "Predicting Non-Routine Discharge in Cerebral Palsy Patients Undergoing Spinal Fusion"
output: github_document
---

![Wheelchair](./images/wheelchair.jpg)

# Table of Contents

* <a href="#intro">Introduction</a>
* <a href="#characterize">Data Characterization</a>
* <a href="#tidying">Tidying The Data</a>
* <a href="#lit">Literature Review</a>
* <a href="#sub">Subanalyses</a>
* <a href="#regress">Regression Analysis</a>
* <a href="#conclusion">Discussion</a>
* <a href="#changes">Changes Mid-Report</a>
* <a href="#refs">References</a>

---

### Authors

* Katherine Dimitripoulou PhD (UNI: kd2524)
* Jerri Chen MD, PhD (UNI: jc4166)
* Lisa Eisler MD (UNI: ldl2113)

<h1 id="intro">Introduction</h1>

## Project Motivation

Children with cerebral palsy (CP) often present with a curvature of the spine, or scoliosis, as a result of abnormal muscle tone and postural weakness.<sup>[1](https://www.flintrehab.com/2019/cerebral-palsy-scoliosis/)</sup> The clinical characteristics of this scoliosis in CP patients involve a deformity of the lumbar and thoracic spine often  accompanied by pelvic torque and postural problems, which leads to loss of function and pain. Severe spinal curves (>50 degrees) are difficult to control with braces, especially if they are rapidly growing. Surgical treatment is often the recommended intervention to prevent further deterioration of functional mobility, and improve quality of life. 

The surgical treatment of individuals with CP who present with severe neuromuscular scoliosis has been associated with peri- and postoperative complication rates as high as 75%. Mohamad et al. (2007) carried out a retrospective record review of 175 patients with neuromuscular scoliosis, with 73.7 % of them being patients with CP.<sup>[2](https://www.ncbi.nlm.nih.gov/pubmed/17513958/)</sup> The peri- and post-operative complications rate was 33.1 % (58/175). Patients experienced a combination of pulmonary complications (~20%), infections (8%), neurological (4%), and cardiovascular problems (4%). In another retrospective study, Tsirikos et al. (2008) reported data in 287 patients with CP who underwent spinal fusion.<sup>[3](https://www.ncbi.nlm.nih.gov/pubmed/18449049/)</sup> They reported major complications including 3 perioperative deaths, an intraoperative complication rate of 10.8 % (38/287), an early postoperative (within 6 weeks) complication rate of 9.4 % (27/287), and a late postoperative complication rate of 10.1 % (29/ 287). Lastly, a prospective cohort study with 127 patients with CP (Samdani, et.al. 2016) reported an overall 39.4% of  major perioperative complications that resulted in increased hospitalization length, use of intensive care unit, and readmission. The authors reported perioperative risk variables such as increase of blood loss, staged procedures and the lack of antifibrinolytic use.<sup>[4](https://www.ncbi.nlm.nih.gov/pubmed/26148567/)</sup> They also reported some pre-operative indicators such as the larger preoperative kyphosis, lower body mass index (BMI) as risk factors for complications.

In all studies, there appear to be pre-operative risk factors associated with increased complications, but no study has comprehensively examined these factors. In addition, no study has examined non-routine discharge, with discharge to home (or home facility) assumed to be the routine as well as preferred outcome from a rehabilitation standpoint. We believe that patients and their families benefit from reasonable expectations about the chance of a decline in function, higher-level care needs or even death in the initial 30-day postoperative period. A model predicting non-routine discharge (defined as discharge to a higher level of care including postoperative death). 

 Our team comprises anesthesiologists and rehabilitation therapists who can combine expertise to develop behavioral and biological intervention protocols, and to make decisions regarding the proper timing and optimization for surgery.


## Project Roadmap


<h1 id="characterize">Data Characterization</h1>

```{r setup, message=FALSE, warning=FALSE}
library(tidyverse)
library(haven)
library(plotly)
library(viridis)
library(data.table)
library(formattable)
library(readxl)

# Formatting plot output
knitr::opts_chunk$set(
  out.width = "90%"
  )
# Set the plot design
theme_set(theme_classic() + 
            theme(legend.position = "bottom", 
                  legend.key.size = unit(1.5, "line"),
                  plot.title = element_text(hjust = 0.5)))
# Raw data
nsqipspineCP_1617 = read_csv("./data/nsqipspineCP_1617.csv")
```

In its raw form, the data has `r nrow(nsqipspineCP_1617)` rows and `r ncol(nsqipspineCP_1617)` columns. Each row corresponds to a single spinal fusion and 384 demographic, medical, surgical, and pre/intra/postoperative characteristics and events, which required a massive amount of chart review by a clinical reviewer.

A copy of the data could not be shared due to licensing agreements.

This is a focused analysis, interested only in a handful of important postoperative outcomes as they relate to the recovery of CP patients undergoing spinal fusion. These variables are defined here:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
variables = read_excel("data/CPSpineVariables.xlsx")

variables[is.na(variables)] <- ""

formattable(variables, 
            align =c("l","l","l"), 
            list(`Data Category` = formatter(
              "span", 
              style = ~ style(color = "grey",font.weight = "bold"))))
```

Therefore we will tidy the data to that end.

<h1 id="tidying">Tidying the Data</h1>

## Data Reduction & Cleaning

To start the cleaning, we replaced the value "-99" with NA to indicate non-zero missingness. We converted age in days to age in years and height and weight to the metric system. We then created a BMI estimate based on height and weight. American Society of Anesthesiologists Physical Status Classification (ASA Class) was converted from a character variable to a factor variable. Extent of surgical fusion (inflection point 13 levels) was used to create a dichotomous variable, level_13. A dichotomous variable indicating whether the patient returned home or was discharged to a facility was created and null values deleted. A subset of the data was selected for analysis.

```{r, message=FALSE, warning=FALSE}
cp_spine_tidy = nsqipspineCP_1617 %>%
  mutate_if(is.numeric, ~replace(., . == -99, NA)) %>%
  mutate(
    age_years = age_days/365.25,
    height = height*2.54,
    weight = weight/2.2) %>%
  mutate(
    bmi = weight/((height/100)*(height/100)),
    asa_status = case_when(
      asaclas == "ASA 1 - No Disturb" ~ "1",
      asaclas == "ASA 2 - Mild Disturb" ~ "2",
      asaclas == "ASA 3 - Severe Disturb" ~ "3",
      asaclas == "ASA 4 - Life Threat" ~ "4",
      asaclas == "None assigned" ~ "NA"),
    home_discharge = case_when(
      dischdest == "Expired" ~ "FALSE",
      dischdest == "Facility Which was Home" ~ "TRUE",
      dischdest == "Home" ~ "TRUE",
      dischdest == "Rehab" ~ "FALSE",
      dischdest == "Separate Acute Care" ~ "FALSE",
      dischdest == "Skilled Care, Not Home" ~ "FALSE",
      dischdest == "Unknown" ~ "NA",
      dischdest == "Unskilled Facility Not Home" ~ "FALSE",
      dischdest == "NULL" ~ "NA"),
    level_13 = case_when(
      prncptx == "ARTHRODESIS, ANTERIOR, FOR SPINAL DEFORMITY, WITH OR WITHOUT CAST; 2 TO 3 VERTEBRAL SEGMENTS" ~ "FALSE",
      prncptx == "ARTHRODESIS, ANTERIOR, FOR SPINAL DEFORMITY, WITH OR WITHOUT CAST; 4 TO 7 VERTEBRAL SEGMENTS" ~ "FALSE",
      prncptx == "ARTHRODESIS, ANTERIOR, FOR SPINAL DEFORMITY, WITH OR WITHOUT CAST; 8 OR MORE VERTEBRAL SEGMENTS" ~ "FALSE",
      prncptx == "ARTHRODESIS, POSTERIOR, FOR SPINAL DEFORMITY, WITH OR WITHOUT CAST; UP TO 6 VERTEBRAL SEGMENTS" ~ "FALSE",
      prncptx == "ARTHRODESIS, POSTERIOR, FOR SPINAL DEFORMITY, WITH OR WITHOUT CAST; 7 TO 12 VERTEBRAL SEGMENTS" ~ "FALSE",
      prncptx == "ARTHRODESIS, POSTERIOR, FOR SPINAL DEFORMITY, WITH OR WITHOUT CAST; 13 OR MORE VERTEBRAL SEGMENTS" ~ "TRUE")) %>%
  filter(home_discharge != "NA") %>% 
  select(pufyear_x:ped_spn_post_neurodeftype, age_years, sex, height, weight, bmi, ethnicity_hispanic, race, asa_status, transt, ventilat, asthma, hxcld, oxygen_sup, crf, impcogstat, seizure, nutr_support, hemodisorder, level_13, optime, tothlos, d_opto_dis, death30yn, supinfec, wndinfd, orgspcssi, dehis, oupneumo, pulembol, renainsf, urninfec, cszre, neurodef, cdarrest, othbleed, bleed_ml_tot, othcdiff, othsysep, unplannedreadmission1, reoperation, dischdest, home_discharge)
```

